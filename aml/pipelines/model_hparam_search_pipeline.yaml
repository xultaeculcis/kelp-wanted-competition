$schema: https://azuremlschemas.azureedge.net/latest/pipelineJob.schema.json
type: pipeline
description: Hyperparameter search for model encoder and architecture
experiment_name: model-hparam-search

settings:
  default_compute: azureml:gpu-4c-28g-t4-nc4ast4v3-spot
  default_datastore: azureml:workspaceblobstore

jobs:
  sweep_step:
    type: sweep

    resources:
      shm_size: "12g"

    inputs:
      data_dir:
        type: uri_folder
        mode: download
        path: azureml:train_dataset@latest
      metadata_file:
        type: uri_file
        mode: download
        path: azureml:metadata_file@latest
      dataset_stats_file:
        type: uri_file
        mode: download
        path: azureml:dataset_stats_file:2

    outputs:
      output_dir:

    sampling_algorithm: random

    trial: file:../components/train_model.yaml

    search_space:
      encoder:
        type: choice
        values:
          - resnet18
          - resnet34
          - resnet50
          - resnet101
          - resnet152
          - resnext50_32x4d
          - resnext101_32x4d
          - resnext101_32x8d
          - resnext101_32x16d
          - resnext101_32x32d
          - resnext101_32x48d
          - timm-resnest14d
          - timm-resnest26d
          - timm-resnest50d
          - timm-resnest101e
          - timm-resnest200e
          - timm-resnest269e
          - timm-resnest50d_4s2x40d
          - timm-resnest50d_1s4x24d
          - timm-res2net50_26w_4s
          - timm-res2net101_26w_4s
          - timm-res2net50_26w_6s
          - timm-res2net50_26w_8s
          - timm-res2net50_48w_2s
          - timm-res2net50_14w_8s
          - timm-res2next50
          - timm-regnetx_002
          - timm-regnetx_004
          - timm-regnetx_006
          - timm-regnetx_008
          - timm-regnetx_016
          - timm-regnetx_032
          - timm-regnetx_040
          - timm-regnetx_064
          - timm-regnetx_080
          - timm-regnetx_120
          - timm-regnetx_160
          - timm-regnetx_320
          - timm-regnety_002
          - timm-regnety_004
          - timm-regnety_006
          - timm-regnety_008
          - timm-regnety_016
          - timm-regnety_032
          - timm-regnety_040
          - timm-regnety_064
          - timm-regnety_080
          - timm-regnety_120
          - timm-regnety_160
          - timm-regnety_320
          - timm-gernet_s
          - timm-gernet_m
          - timm-gernet_l
          - senet154
          - se_resnet50
          - se_resnet101
          - se_resnet152
          - se_resnext50_32x4d
          - se_resnext101_32x4d
          - timm-skresnet18
          - timm-skresnet34
          - timm-skresnext50_32x4d
          - densenet121
          - densenet169
          - densenet201
          - densenet161
          - inceptionresnetv2
          - inceptionv4
          - xception
          - efficientnet-b0
          - efficientnet-b1
          - efficientnet-b2
          - efficientnet-b3
          - efficientnet-b4
          - efficientnet-b5
          - efficientnet-b6
          - efficientnet-b7
          - timm-efficientnet-b0
          - timm-efficientnet-b1
          - timm-efficientnet-b2
          - timm-efficientnet-b3
          - timm-efficientnet-b4
          - timm-efficientnet-b5
          - timm-efficientnet-b6
          - timm-efficientnet-b7
          - timm-efficientnet-b8
          - timm-efficientnet-l2
          - timm-efficientnet-lite0
          - timm-efficientnet-lite1
          - timm-efficientnet-lite2
          - timm-efficientnet-lite3
          - timm-efficientnet-lite4
          - mobilenet_v2
          - timm-mobilenetv3_large_075
          - timm-mobilenetv3_large_100
          - timm-mobilenetv3_large_minimal_100
          - timm-mobilenetv3_small_075
          - timm-mobilenetv3_small_100
          - timm-mobilenetv3_small_minimal_100
          - dpn68
          - dpn68b
          - dpn92
          - dpn98
          - dpn107
          - dpn131
          - vgg11
          - vgg11_bn
          - vgg13
          - vgg13_bn
          - vgg16
          - vgg16_bn
          - vgg19
          - vgg19_bn
          - mit_b0
          - mit_b1
          - mit_b2
          - mit_b3
          - mit_b4
          - mit_b5
          - mobileone_s0
          - mobileone_s1
          - mobileone_s2
          - mobileone_s3
          - mobileone_s4
          # PyTorch Image Models
          - tu-SelecSls42
          - tu-SelecSls42b
          - tu-SelecSls60
          - tu-SelecSls60b
          - tu-SelecSls84
          - tu-bat_resnext26ts
          - tu-botnet26t_256
          - tu-botnet50ts_256
          - tu-coatnet_0_224
          - tu-coatnet_0_rw_224
          - tu-coatnet_1_224
          - tu-coatnet_1_rw_224
          - tu-coatnet_2_224
          - tu-coatnet_2_rw_224
          - tu-coatnet_3_224
          - tu-coatnet_3_rw_224
          - tu-coatnet_4_224
          - tu-coatnet_5_224
          - tu-coatnet_bn_0_rw_224
          - tu-coatnet_nano_cc_224
          - tu-coatnet_nano_rw_224
          - tu-coatnet_pico_rw_224
          - tu-coatnet_rmlp_0_rw_224
          - tu-coatnet_rmlp_1_rw2_224
          - tu-coatnet_rmlp_1_rw_224
          - tu-coatnet_rmlp_2_rw_224
          - tu-coatnet_rmlp_2_rw_384
          - tu-coatnet_rmlp_3_rw_224
          - tu-coatnet_rmlp_nano_rw_224
          - tu-coatnext_nano_rw_224
          - tu-cs3darknet_focus_l
          - tu-cs3darknet_focus_m
          - tu-cs3darknet_focus_s
          - tu-cs3darknet_focus_x
          - tu-cs3darknet_l
          - tu-cs3darknet_m
          - tu-cs3darknet_s
          - tu-cs3darknet_x
          - tu-cs3edgenet_x
          - tu-cs3se_edgenet_x
          - tu-cs3sedarknet_l
          - tu-cs3sedarknet_x
          - tu-cs3sedarknet_xdw
          - tu-cspresnet50
          - tu-cspresnet50d
          - tu-cspresnet50w
          - tu-cspresnext50
          - tu-densenet121
          - tu-densenet161
          - tu-densenet169
          - tu-densenet201
          - tu-densenet264d
          - tu-densenetblur121d
          - tu-dla102
          - tu-dla102x
          - tu-dla102x2
          - tu-dla169
          - tu-dla34
          - tu-dla46_c
          - tu-dla46x_c
          - tu-dla60
          - tu-dla60_res2net
          - tu-dla60_res2next
          - tu-dla60x
          - tu-dla60x_c
          - tu-dm_nfnet_f0
          - tu-dm_nfnet_f1
          - tu-dm_nfnet_f2
          - tu-dm_nfnet_f3
          - tu-dm_nfnet_f4
          - tu-dm_nfnet_f5
          - tu-dm_nfnet_f6
          - tu-dpn107
          - tu-dpn131
          - tu-dpn48b
          - tu-dpn68
          - tu-dpn68b
          - tu-dpn92
          - tu-dpn98
          - tu-eca_botnext26ts_256
          - tu-eca_halonext26ts
          - tu-eca_nfnet_l0
          - tu-eca_nfnet_l1
          - tu-eca_nfnet_l2
          - tu-eca_nfnet_l3
          - tu-eca_resnet33ts
          - tu-eca_resnext26ts
          - tu-eca_vovnet39b
          - tu-ecaresnet101d
          - tu-ecaresnet101d_pruned
          - tu-ecaresnet200d
          - tu-ecaresnet269d
          - tu-ecaresnet26t
          - tu-ecaresnet50d
          - tu-ecaresnet50d_pruned
          - tu-ecaresnet50t
          - tu-ecaresnetlight
          - tu-ecaresnext26t_32x4d
          - tu-ecaresnext50t_32x4d
          - tu-efficientnet_b0
          - tu-efficientnet_b0_g16_evos
          - tu-efficientnet_b0_g8_gn
          - tu-efficientnet_b0_gn
          - tu-efficientnet_b1
          - tu-efficientnet_b1_pruned
          - tu-efficientnet_b2
          - tu-efficientnet_b2_pruned
          - tu-efficientnet_b2a
          - tu-efficientnet_b3
          - tu-efficientnet_b3_g8_gn
          - tu-efficientnet_b3_gn
          - tu-efficientnet_b3_pruned
          - tu-efficientnet_b3a
          - tu-efficientnet_b4
          - tu-efficientnet_b5
          - tu-efficientnet_b6
          - tu-efficientnet_b7
          - tu-efficientnet_b8
          - tu-efficientnet_cc_b0_4e
          - tu-efficientnet_cc_b0_8e
          - tu-efficientnet_cc_b1_8e
          - tu-efficientnet_el
          - tu-efficientnet_el_pruned
          - tu-efficientnet_em
          - tu-efficientnet_es
          - tu-efficientnet_es_pruned
          - tu-efficientnet_l2
          - tu-efficientnet_lite0
          - tu-efficientnet_lite1
          - tu-efficientnet_lite2
          - tu-efficientnet_lite3
          - tu-efficientnet_lite4
          - tu-efficientnetv2_l
          - tu-efficientnetv2_m
          - tu-efficientnetv2_rw_m
          - tu-efficientnetv2_rw_s
          - tu-efficientnetv2_rw_t
          - tu-efficientnetv2_s
          - tu-efficientnetv2_xl
          - tu-ese_vovnet19b_dw
          - tu-ese_vovnet19b_slim
          - tu-ese_vovnet19b_slim_dw
          - tu-ese_vovnet39b
          - tu-ese_vovnet39b_evos
          - tu-ese_vovnet57b
          - tu-ese_vovnet99b
          - tu-fbnetc_100
          - tu-fbnetv3_b
          - tu-fbnetv3_d
          - tu-fbnetv3_g
          - tu-gc_efficientnetv2_rw_t
          - tu-gcresnet33ts
          - tu-gcresnet50t
          - tu-gcresnext26ts
          - tu-gcresnext50ts
          - tu-gernet_l
          - tu-gernet_m
          - tu-gernet_s
          - tu-ghostnet_050
          - tu-ghostnet_100
          - tu-ghostnet_130
          - tu-halo2botnet50ts_256
          - tu-halonet26t
          - tu-halonet50ts
          - tu-halonet_h1
          - tu-haloregnetz_b
          - tu-hardcorenas_a
          - tu-hardcorenas_b
          - tu-hardcorenas_c
          - tu-hardcorenas_d
          - tu-hardcorenas_e
          - tu-hardcorenas_f
          - tu-hrnet_w18
          - tu-hrnet_w18_small
          - tu-hrnet_w18_small_v2
          - tu-hrnet_w18_ssld
          - tu-hrnet_w30
          - tu-hrnet_w32
          - tu-hrnet_w40
          - tu-hrnet_w44
          - tu-hrnet_w48
          - tu-hrnet_w48_ssld
          - tu-hrnet_w64
          - tu-inception_resnet_v2
          - tu-inception_v3
          - tu-inception_v4
          - tu-lambda_resnet26rpt_256
          - tu-lambda_resnet26t
          - tu-lambda_resnet50ts
          - tu-lamhalobotnet50ts_256
          - tu-lcnet_035
          - tu-lcnet_050
          - tu-lcnet_075
          - tu-lcnet_100
          - tu-lcnet_150
          - tu-legacy_senet154
          - tu-legacy_seresnet101
          - tu-legacy_seresnet152
          - tu-legacy_seresnet18
          - tu-legacy_seresnet34
          - tu-legacy_seresnet50
          - tu-legacy_seresnext101_32x4d
          - tu-legacy_seresnext26_32x4d
          - tu-legacy_seresnext50_32x4d
          - tu-legacy_xception
          - tu-maxvit_base_tf_224
          - tu-maxvit_base_tf_384
          - tu-maxvit_base_tf_512
          - tu-maxvit_large_tf_224
          - tu-maxvit_large_tf_384
          - tu-maxvit_large_tf_512
          - tu-maxvit_nano_rw_256
          - tu-maxvit_pico_rw_256
          - tu-maxvit_rmlp_base_rw_224
          - tu-maxvit_rmlp_base_rw_384
          - tu-maxvit_rmlp_nano_rw_256
          - tu-maxvit_rmlp_pico_rw_256
          - tu-maxvit_rmlp_small_rw_224
          - tu-maxvit_rmlp_small_rw_256
          - tu-maxvit_rmlp_tiny_rw_256
          - tu-maxvit_small_tf_224
          - tu-maxvit_small_tf_384
          - tu-maxvit_small_tf_512
          - tu-maxvit_tiny_pm_256
          - tu-maxvit_tiny_rw_224
          - tu-maxvit_tiny_rw_256
          - tu-maxvit_tiny_tf_224
          - tu-maxvit_tiny_tf_384
          - tu-maxvit_tiny_tf_512
          - tu-maxvit_xlarge_tf_224
          - tu-maxvit_xlarge_tf_384
          - tu-maxvit_xlarge_tf_512
          - tu-maxxvit_rmlp_nano_rw_256
          - tu-maxxvit_rmlp_small_rw_256
          - tu-maxxvit_rmlp_tiny_rw_256
          - tu-maxxvitv2_nano_rw_256
          - tu-maxxvitv2_rmlp_base_rw_224
          - tu-maxxvitv2_rmlp_base_rw_384
          - tu-maxxvitv2_rmlp_large_rw_224
          - tu-mixnet_l
          - tu-mixnet_m
          - tu-mixnet_s
          - tu-mixnet_xl
          - tu-mixnet_xxl
          - tu-mnasnet_050
          - tu-mnasnet_075
          - tu-mnasnet_100
          - tu-mnasnet_140
          - tu-mnasnet_a1
          - tu-mnasnet_b1
          - tu-mnasnet_small
          - tu-mobilenetv2_035
          - tu-mobilenetv2_050
          - tu-mobilenetv2_075
          - tu-mobilenetv2_100
          - tu-mobilenetv2_110d
          - tu-mobilenetv2_120d
          - tu-mobilenetv2_140
          - tu-mobilenetv3_large_075
          - tu-mobilenetv3_large_100
          - tu-mobilenetv3_rw
          - tu-mobilenetv3_small_050
          - tu-mobilenetv3_small_075
          - tu-mobilenetv3_small_100
          - tu-mobilevit_s
          - tu-mobilevit_xs
          - tu-mobilevit_xxs
          - tu-mobilevitv2_050
          - tu-mobilevitv2_075
          - tu-mobilevitv2_100
          - tu-mobilevitv2_125
          - tu-mobilevitv2_150
          - tu-mobilevitv2_175
          - tu-mobilevitv2_200
          - tu-nasnetalarge
          - tu-nf_ecaresnet101
          - tu-nf_ecaresnet26
          - tu-nf_ecaresnet50
          - tu-nf_regnet_b0
          - tu-nf_regnet_b1
          - tu-nf_regnet_b2
          - tu-nf_regnet_b3
          - tu-nf_regnet_b4
          - tu-nf_regnet_b5
          - tu-nf_resnet101
          - tu-nf_resnet26
          - tu-nf_resnet50
          - tu-nf_seresnet101
          - tu-nf_seresnet26
          - tu-nf_seresnet50
          - tu-nfnet_f0
          - tu-nfnet_f1
          - tu-nfnet_f2
          - tu-nfnet_f3
          - tu-nfnet_f4
          - tu-nfnet_f5
          - tu-nfnet_f6
          - tu-nfnet_f7
          - tu-nfnet_l0
          - tu-pnasnet5large
          - tu-regnetv_040
          - tu-regnetv_064
          - tu-regnetx_002
          - tu-regnetx_004
          - tu-regnetx_004_tv
          - tu-regnetx_006
          - tu-regnetx_008
          - tu-regnetx_016
          - tu-regnetx_032
          - tu-regnetx_040
          - tu-regnetx_064
          - tu-regnetx_080
          - tu-regnetx_120
          - tu-regnetx_160
          - tu-regnetx_320
          - tu-regnety_002
          - tu-regnety_004
          - tu-regnety_006
          - tu-regnety_008
          - tu-regnety_008_tv
          - tu-regnety_016
          - tu-regnety_032
          - tu-regnety_040
          - tu-regnety_040_sgn
          - tu-regnety_064
          - tu-regnety_080
          - tu-regnety_080_tv
          - tu-regnety_120
          - tu-regnety_1280
          - tu-regnety_160
          - tu-regnety_2560
          - tu-regnety_320
          - tu-regnety_640
          - tu-regnetz_005
          - tu-regnetz_040
          - tu-regnetz_040_h
          - tu-regnetz_b16
          - tu-regnetz_b16_evos
          - tu-regnetz_c16
          - tu-regnetz_c16_evos
          - tu-regnetz_d32
          - tu-regnetz_d8
          - tu-regnetz_d8_evos
          - tu-regnetz_e8
          - tu-repvgg_a2
          - tu-repvgg_b0
          - tu-repvgg_b1
          - tu-repvgg_b1g4
          - tu-repvgg_b2
          - tu-repvgg_b2g4
          - tu-repvgg_b3
          - tu-repvgg_b3g4
          - tu-res2net101_26w_4s
          - tu-res2net101d
          - tu-res2net50_14w_8s
          - tu-res2net50_26w_4s
          - tu-res2net50_26w_6s
          - tu-res2net50_26w_8s
          - tu-res2net50_48w_2s
          - tu-res2net50d
          - tu-res2next50
          - tu-resnest101e
          - tu-resnest14d
          - tu-resnest200e
          - tu-resnest269e
          - tu-resnest26d
          - tu-resnest50d
          - tu-resnest50d_1s4x24d
          - tu-resnest50d_4s2x40d
          - tu-resnet101
          - tu-resnet101c
          - tu-resnet101d
          - tu-resnet101s
          - tu-resnet10t
          - tu-resnet14t
          - tu-resnet152
          - tu-resnet152c
          - tu-resnet152d
          - tu-resnet152s
          - tu-resnet18
          - tu-resnet18d
          - tu-resnet200
          - tu-resnet200d
          - tu-resnet26
          - tu-resnet26d
          - tu-resnet26t
          - tu-resnet32ts
          - tu-resnet33ts
          - tu-resnet34
          - tu-resnet34d
          - tu-resnet50
          - tu-resnet50_gn
          - tu-resnet50c
          - tu-resnet50d
          - tu-resnet50s
          - tu-resnet50t
          - tu-resnet51q
          - tu-resnet61q
          - tu-resnetaa101d
          - tu-resnetaa34d
          - tu-resnetaa50
          - tu-resnetaa50d
          - tu-resnetblur101d
          - tu-resnetblur18
          - tu-resnetblur50
          - tu-resnetblur50d
          - tu-resnetrs101
          - tu-resnetrs152
          - tu-resnetrs200
          - tu-resnetrs270
          - tu-resnetrs350
          - tu-resnetrs420
          - tu-resnetrs50
          - tu-resnetv2_101
          - tu-resnetv2_101d
          - tu-resnetv2_101x1_bit
          - tu-resnetv2_101x3_bit
          - tu-resnetv2_152
          - tu-resnetv2_152d
          - tu-resnetv2_152x2_bit
          - tu-resnetv2_152x4_bit
          - tu-resnetv2_50
          - tu-resnetv2_50d
          - tu-resnetv2_50d_evos
          - tu-resnetv2_50d_frn
          - tu-resnetv2_50d_gn
          - tu-resnetv2_50t
          - tu-resnetv2_50x1_bit
          - tu-resnetv2_50x3_bit
          - tu-resnext101_32x16d
          - tu-resnext101_32x32d
          - tu-resnext101_32x4d
          - tu-resnext101_32x8d
          - tu-resnext101_64x4d
          - tu-resnext26ts
          - tu-resnext50_32x4d
          - tu-resnext50d_32x4d
          - tu-rexnet_100
          - tu-rexnet_130
          - tu-rexnet_150
          - tu-rexnet_200
          - tu-rexnet_300
          - tu-rexnetr_100
          - tu-rexnetr_130
          - tu-rexnetr_150
          - tu-rexnetr_200
          - tu-rexnetr_300
          - tu-sebotnet33ts_256
          - tu-sehalonet33ts
          - tu-semnasnet_050
          - tu-semnasnet_075
          - tu-semnasnet_100
          - tu-semnasnet_140
          - tu-senet154
          - tu-seresnet101
          - tu-seresnet152
          - tu-seresnet152d
          - tu-seresnet18
          - tu-seresnet200d
          - tu-seresnet269d
          - tu-seresnet33ts
          - tu-seresnet34
          - tu-seresnet50
          - tu-seresnet50t
          - tu-seresnetaa50d
          - tu-seresnext101_32x4d
          - tu-seresnext101_32x8d
          - tu-seresnext101_64x4d
          - tu-seresnext101d_32x8d
          - tu-seresnext26d_32x4d
          - tu-seresnext26t_32x4d
          - tu-seresnext26tn_32x4d
          - tu-seresnext26ts
          - tu-seresnext50_32x4d
          - tu-seresnextaa101d_32x8d
          - tu-skresnet18
          - tu-skresnet34
          - tu-skresnet50
          - tu-skresnet50d
          - tu-skresnext50_32x4d
          - tu-spnasnet_100
          - tu-tf_efficientnet_b0
          - tu-tf_efficientnet_b1
          - tu-tf_efficientnet_b2
          - tu-tf_efficientnet_b3
          - tu-tf_efficientnet_b4
          - tu-tf_efficientnet_b5
          - tu-tf_efficientnet_b6
          - tu-tf_efficientnet_b7
          - tu-tf_efficientnet_b8
          - tu-tf_efficientnet_cc_b0_4e
          - tu-tf_efficientnet_cc_b0_8e
          - tu-tf_efficientnet_cc_b1_8e
          - tu-tf_efficientnet_el
          - tu-tf_efficientnet_em
          - tu-tf_efficientnet_es
          - tu-tf_efficientnet_l2
          - tu-tf_efficientnet_lite0
          - tu-tf_efficientnet_lite1
          - tu-tf_efficientnet_lite2
          - tu-tf_efficientnet_lite3
          - tu-tf_efficientnet_lite4
          - tu-tf_efficientnetv2_b0
          - tu-tf_efficientnetv2_b1
          - tu-tf_efficientnetv2_b2
          - tu-tf_efficientnetv2_b3
          - tu-tf_efficientnetv2_l
          - tu-tf_efficientnetv2_m
          - tu-tf_efficientnetv2_s
          - tu-tf_efficientnetv2_xl
          - tu-tf_mixnet_l
          - tu-tf_mixnet_m
          - tu-tf_mixnet_s
          - tu-tf_mobilenetv3_large_075
          - tu-tf_mobilenetv3_large_100
          - tu-tf_mobilenetv3_large_minimal_100
          - tu-tf_mobilenetv3_small_075
          - tu-tf_mobilenetv3_small_100
          - tu-tf_mobilenetv3_small_minimal_100
          - tu-tinynet_a
          - tu-tinynet_b
          - tu-tinynet_c
          - tu-tinynet_d
          - tu-tinynet_e
          - tu-vovnet39a
          - tu-vovnet57a
          - tu-wide_resnet101_2
          - tu-wide_resnet50_2
          - tu-xception41
          - tu-xception41p
          - tu-xception65
          - tu-xception65p
          - tu-xception71

      architecture:
        type: choice
        values:
          - unet

    objective:
      goal: maximize
      primary_metric: hp_metric

    limits:
      max_total_trials: 1000
      max_concurrent_trials: 50
      trial_timeout: 3600  # 1 hour
      timeout: 259200  # 3 days
